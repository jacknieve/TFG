<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
	xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

<head>
	<title>Perfil de usuario</title>
	<meta charset="UTF-8">
	<link th:href="@{/css/bootstrap-4.4.1.css}" rel="stylesheet">
	<link th:href="@{/css/general.css}" rel="stylesheet">
	<link th:href="@{/css/notification.lee}" rel="stylesheet/less" type="text/css" />
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.1/angular.min.js"></script>
	<script type="text/javascript" th:src="@{/js/sockjs.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/stomp.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/notification.js}"></script>
	<script type="text/javascript" th:src="@{/js/perfil.js}"></script>

</head>

<body ng-app="appConsumer" ng-cloak>
	<div ng-controller="userController" ng-class="{ 'seccionDesabilitada': popupAbierto || conexionPerdida}">
		<nav class="navbar navbar-expand-lg navbar-light fixed-top header"
			th:style="'background-color: '+@{${color}}+';'">
			<a class="navbar-brand" th:href="@{/home}">
				<img th:src="@{/images/icono_prueba.png}" id="borderIcono" width="60" height="60" alt="" />
			</a>
			<span th:if="${logo}">
				<a class="navbar-brand" href="#">
					<!--Aqui iria a la pagina de la institucion-->
					<img th:src="@{${logo}}" width="90" height="60" class="borderIcono" alt="" />
				</a>
			</span>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
				aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<span class="linkNavRight d-block d-lg-none">
				<!--<button ng-click="abrirBorrar()" class="buttonNav">
					Eliminar cuenta
				</button>-->
				<a th:href="@{/auth/logout}">
					<div class="buttonNav">Cerrar sesión</div>
				</a>
			</span>
			<div th:switch="${rol}" class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul th:case="'Mentorizado'" class="navbar-nav mr-auto">
					<li class="nav-item">
						<a class="headerLink nav-link" th:href="@{/user/principal}"
							th:style="${letrasBlancas ? 'color: white' : 'color: black'}">Notificaciones</a>
					</li>
					<li class="nav-item">
						<a class="headerLink nav-link" th:href="@{/user/principal#mentorizaciones}"
							th:style="${letrasBlancas ? 'color: white' : 'color: black'}">Mis
							mentores</a>
					</li>
					<li class="nav-item">
						<a class="headerLink nav-link" th:href="@{/user/principal#busqueda}"
							th:style="${letrasBlancas ? 'color: white' : 'color: black'}">Buscar mentores</a>
					</li>
					<li class="nav-item">
						<a class="headerLink nav-link" th:href="@{/user/principal#puntuar}"
							th:style="${letrasBlancas ? 'color: white' : 'color: black'}">Puntuar mentorizaciones</a>
					</li>
					<li class="nav-item">
						<a class="headerLink nav-link" th:href="@{/chat}"
							th:style="${letrasBlancas ? 'color: white' : 'color: black'}">Mis chats</a>
					</li>
				</ul>
				<ul th:case="'Mentor'" class="navbar-nav mr-auto">
					<li class="nav-item">
						<a class="headerLink nav-link" th:href="@{/user/principal}"
							th:style="${letrasBlancas ? 'color: white' : 'color: black'}">Notificaciones</a>
					</li>
					<li class="nav-item">
						<a class="headerLink nav-link" th:href="@{/user/principal#mentorizaciones}"
							th:style="${letrasBlancas ? 'color: white' : 'color: black'}">Mis mentorizados</a>
					</li>
					<li class="nav-item">
						<a class="headerLink nav-link" th:href="@{/user/principal#peticiones}"
							th:style="${letrasBlancas ? 'color: white' : 'color: black'}">Solicitudes recibidas</a>
					</li>
					<li class="nav-item">
						<a class="headerLink nav-link" th:href="@{/chat}"
							th:style="${letrasBlancas ? 'color: white' : 'color: black'}">Mis chats</a>
					</li>
				</ul>
				<div th:case="*">
					Tienes un rol no esperado para estar aqui, de hecho, no deberias haber podido entrar.
				</div>
			</div>

			<span class="linkNavRight d-none d-lg-block">
				<!--<button ng-click="abrirBorrar()" class="buttonNav">
					Eliminar cuenta
				</button>-->
				<a th:href="@{/auth/logout}">
					<div class="buttonNav">Cerrar sesión</div>
				</a>
			</span>
		</nav>
		<div class="sidebar sidebar2">
			<div class="zonaNotificacionesLateral zonaNotificacionesLateral2">
				<div notifications="bottom right"></div>
			</div>
		</div>
		<div class="main">
			<div class="espacioEntreSecciones"></div>
			<section class="container cuerpoSeccion" style="height: auto; overflow-y: auto;">
				<br>
				<div class="row">
					<div class="col-lg-12 text-center" ng-show="cargando">Cargando...</div>
				</div>
				<div class="row">
					<div class="col-lg-10 offset-lg-1">
						<form name="form" class="container">
							<div class="row">
								<div class="col-md-4 text-center">
									<img ng-src="{{foto}}" class="fotoPerfil" alt="" /><br>
									<form>
										<label for="image" class="botonSubirFichero">Seleccione una imagen</label>
										<input id="image" style="display:none;" type="file" file-model="imagenPerfil">
										{{imagenPerfil.name}}<br>
									</form>
									<button class="botonInterfaz" ng-click="subirFoto()"
										ng-disabled="cargando">Aceptar</button>
								</div>
								<div class="col-md-8">
									<div class="row">
										<div class="col-md-4 col-sm-5">
											<strong>Correo electrónico:</strong>
										</div>
										<div class="col-md-8 col-sm-7">
											<span th:text="${correo}" />
										</div>
										<div class="col-md-4 col-sm-5" th:if="${fregistro}">
											<strong>Fecha de registro:</strong>
										</div>
										<div class="col-md-8 col-sm-7" th:if="${fregistro}">
											<span th:text="${fregistro}" />
										</div>
										<div class="col-sm-4">
											<label>Nombre</label>
										</div>
										<div class="col-sm-8">
											<input ng-model="usuario.nombre" name="nombre"
												ng-pattern="/^[a-zA-ZÀ-ÿ\u00f1\u00d1]{1,255}$/" required />
										</div>
										<div class="col-sm-12" ng-hide="cargando">
											<span ng-show="form.nombre.$error.required" class="mensajeError">Es
												necesario introducir
												un nombre. </span>
											<span ng-show="form.nombre.$error.pattern" class="mensajeError"><br>No
												tiene el formato
												correcto </span>
										</div>
										<div class="col-sm-4">
											<label>Primer apellido</label>
										</div>
										<div class="col-sm-8">
											<input ng-model="usuario.papellido" name="papellido"
												ng-pattern="/^[a-zA-ZÀ-ÿ\u00f1\u00d1\u0020]{0,255}$/" />
										</div>
										<div class="col-sm-12" ng-hide="cargando">
											<span ng-show="form.papellido.$error.pattern" class="mensajeError"><br>No
												tiene el
												formato correcto </span>
										</div>
										<div class="col-sm-4">
											<label>Segundo apellido</label>
										</div>
										<div class="col-sm-8">
											<input ng-model="usuario.sapellido" name="sapellido"
												ng-pattern="/^[a-zA-ZÀ-ÿ\u00f1\u00d1\u0020]{0,255}$/" />
										</div>
										<div class="col-sm-12" ng-hide="cargando">
											<span ng-show="form.sapellido.$error.pattern" class="mensajeError"><br>No
												tiene el
												formato correcto </span>
										</div>
										<div class="col-sm-4">
											<label>Telefono</label>
										</div>
										<div class="col-sm-8">
											<input type="tel" ng-model="usuario.telefono" name="telefono"
												ng-pattern="/^([+][0-9]{2})?[0-9]{9}$/" />
										</div>
										<div class="col-sm-12" ng-hide="cargando">
											<span ng-show="form.sapellido.$error.pattern" class="mensajeError"><br>No
												tiene
												el
												formato correcto </span>
										</div>
										<div class="col-sm-4">
											<label>Nivel de estudios:</label>
										</div>
										<div class="col-sm-8">
											<select ng-model="usuario.nivelEstudiosNivelestudios">
												<div>
													<!--<option th:value="Otros" th:text="'--Escoge uno--'"></option>-->
													<option th:each="i : ${estudios}" th:value="${i.nivelestudios}"
														th:text="${i.nivelestudios}">
													</option>
												</div>
											</select>
										</div>
									</div>
								</div>
								<div class="col-md-12" th:if="${error}">
									<strong>Se ha producido un error:</strong> <span th:text="${error}"
										class="mensajeError" />
								</div>
								<div class="col-md-12" ng-show="errorObtener">
									<span class="mensajeError">Se ha producido un fallo al tratar de obtener la
										información
										de su cuenta, para volver a realizar la consulta, pulse este botón.
									</span>
									<span class="float-right">
										<button ng-click="getInfo()" ng-disabled="cargando" class="redoBoton">
											<img th:src="@{/images/redo.png}" class="redoImage" alt="" /></button>
									</span>
								</div>
								<div class="col-md-10 offset-md-1">
									<label>Descripción:</label><br>
									<div style="text-align: center">
										<textarea ng-model="usuario.descripcion" maxlength="500" name="descripcion"
											style="width: 80%; height: 120px;"></textarea><br>
									</div>
									Caracteres restantes : {{500 - usuario.descripcion.length}}
								</div>
								<div class="col-md-12">
									<label>Tu linkedin</label>
									<input type="url" ng-model="usuario.linkedin" name="linkedin" />
									<span ng-hide="cargando">
										<span ng-hide="form.linkedin.$valid" class="mensajeError"><br>No tiene el
											formato
											correcto </span></span>
								</div>
								<div class="col-md-12" ng-show="usuario.mentor">
									<label>Horas por mes que desea mentorizar: </label>
									4<input type="range" min="4" max="80" step="1" value="4"
										ng-model="usuario.horaspormes" />80 :
									{{usuario.horaspormes}}
								</div>
								<div class="col-md-6">
									Fecha de nacimiento:
									<input type="date" id="fnacimiento" name="fnacimiento" ng-model="mydate"
										min="1900-01-01" max="4000-12-31" />
									<span ng-show="form.fnacimiento.$invalid" class="mensajeError"><br>La fecha está
										fuera de rango</span>
								</div>
								<div class="col-md-6" ng-show="usuario.mentor">
									<label>Entidad</label>
									<input ng-model="usuario.entidad" name="entidad"
										ng-pattern="/^[a-zA-ZÀ-ÿ\u00f1\u00d1\u0020]{0,255}$/" />
									<span ng-hide="cargando">
										<span ng-show="form.entidad.$error.pattern" class="mensajeError"><br>No tiene el
											formato
											correcto </span></span>
								</div>
								<div class="col-md-12">
									<label>Institución al que pertenece el programa de mentoring en el que
										participas:</label>
									<select ng-model="usuario.institucionNombre" ng-change="avisoRefrescar = true">
										<option th:each="i : ${instituciones}" th:value="${i}" th:text="${i}">
										</option>
									</select>
									<div ng-show="avisoRefrescar" style="color: orange;">Para ver la versión de la
										interfaz para esa institución, una vez
										que guardes los cambios, refresca la página o dirígete a otra.</div>

								</div>

								<div class="col-md-12">
									<label>¿Desea recibir notificaciones por correo cuando esta desconectado?</label>
									<input type="checkbox" ng-model="usuario.notificar_correo" />
								</div>

							</div>
						</form>
						<div class="container">
							<hr>
							<h4>Areas de conocimiento <span ng-show="usuario.mentor"> en las que podrías ayudar</span>
								<span ng-hide="usuario.mentor"> en las que estás interesado</span>:
							</h4>
							<hr>
							<div class="row">
								<div class="col-lg-6 areaConocimiento" ng-repeat="area in usuario.areas"
									style="min-height: 40px;">{{area.area}} 
										<button class="botonBorrarNotificacion" ng-click="borrarArea(area)"
									ng-disabled="cargando" style="margin-left: auto;">X</button>
								</div>
								<div class="col-md-12" ng-show="sinareas">No tienes ninguna área de conocimiento
									escogida
								</div>
							</div>
							<hr>
							<div class="row">
								<label class="col-md-3">Añadir nueva area: </label>
								<select class="col-md-4" ng-model="areaseleccioanda">
									<option th:value="'--Escoge una--'" th:text="'--Escoge una--'"></option>
									<option th:each="i : ${areas}" th:value="${i.area}" th:text="${i.area}">
									</option>
								</select>
								<div class="col-md-5">
									<button class="float-right botonInterfaz" ng-click="addArea(areaseleccioanda)"
										ng-disabled="cargando">Añadir</button>
								</div>
							</div>
							<hr>
							<h4>Tus ficheros:
							</h4>
							<hr>
							<div class="row">
								<div class="col-lg-6 areaConocimiento" ng-repeat="file in usuario.ficheros">
									{{file}}
									<button ng-click="dowloadFile(file)" ng-disabled="cargando" class="redoBoton"
										style="margin-left: auto;">
										<img th:src="@{/images/download.png}" class="redoImage" alt="" />
									</button>
									<button ng-click="borrarFile(file)" ng-disabled="cargando" class="redoBoton"
										style="margin-left: 10px;"><img th:src="@{/images/trash.png}" class="redoImage" alt="" />
									</button>
									<!--https://icon-icons.com/es/icono/descarga-actualizaciones-aplicacion-flecha/2353-->

								</div>
								<div class="col-md-12" ng-show="sinficherosperfil">No tienes ningun fichero subido
								</div>
							</div>
							<hr>
							<div class="row">
								<label class="col-md-3">Añadir nuevo fichero: </label>
								<form>
									<label for="files" class="botonSubirFichero">Seleccione un fichero</label>
									<input id="files" style="display:none;" type="file" file-model="ficheroSubir">
									{{ficheroSubir.name}}
								</form>
								<div class="col-md-5">
									<button class="float-right botonInterfaz" ng-click="subirFichero()"
										ng-disabled="cargando">Subir</button>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-md-12 text-center" ng-show="cargando">Cargando...</div>
								<div class="col-md-3"><button class="botonInterfaz" th:text="'Guardar cambios'"
										ng-click="setInfo(usuario)" ng-disabled="cargando" style="width: auto;">Guardar
										cambios</button>
								</div>
								<div class="col-md-9">
									<button class="botonInterfaz" th:text="Deshacer" ng-click="deshacer()"
										ng-disabled="cargando">Deshacer</button> (No se
									recuperaran las
									areas borradas)
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-md-12">
									<button ng-click="abrirBorrar()" class="buttonNav" style="float: right;">
										Eliminar cuenta
									</button>
								</div>
							</div>
						</div>
					</div>
					<hr>

					<div ng-show="borrar" class="popupFondo">
						<div class="popup" style="width: 400px;">Para borrar su cuenta, por favor, introduzca su
							contraseña.<br>
							<form action="#" id="formConfirm" th:action="@{/user/eliminar}" method="POST"
								enctype="utf8">
								<div>
									<input type="password" id="password" name="password" maxlength="255"
										ng-model="password" required />
									<span ng-show="password == ''" style="color: red;"><br>Por favor, introduzca su
										contraseña</span>
								</div>
							</form>
							<button class="botonInterfaz" ng-click="abrirConfirmar()"
								ng-disabled="cargando">Aceptar</button>
							<button class="botonInterfaz" ng-click="abrirBorrar()"
								ng-disabled="cargando">Cancelar</button>
						</div>
					</div>
					<div ng-show="confirmarBorrar" class="popupFondo" style="z-index: 250;">
						<div class="popup" style="width: 400px;z-index: 300;">
							¿Seguro que desea realizar esta acción?<br>Esta acción no es reversible
							(de momento) y su cuenta de correo no podrá ser usada en otra cuenta.<br>
							<button class="botonInterfaz" type="submit" form="formConfirm" th:text="Confirmar"
								ng-disabled="cargando">Confirmar</button>
							<button class="botonInterfaz" th:text="Cancelar"
								ng-click="cancelarConfirmar()">Cancelar</button>
						</div>
					</div>

				</div>
				<br>
			</section>
			<div class="espacioEntreSecciones"></div>
		</div>
		<hr>
		<footer class="container">
			<div class="row">
				<div class="text-center col-lg-12">
					<p>Copyright &copy; 2021 &middot; All Rights Reserved &middot;</p>
				</div>
				<div class="text-center col-lg-3 offset-lg-2 col-md-5 offset-md-1">
					<h4>Normativa</h4>
					<p>Aqui puedes consultar las mormas de uso de la aplicación: <a href="#">ver normas de uso</a></p>
				</div>
				<div class="text-center col-lg-3 offset-lg-2 col-md-5 offset-md-2">
					<h4>Contacto</h4>
					<p>Para cualquier incidencia, contáctenos vía email a <span
							style="color: deepskyblue;">mentoring@gmail.com</span></p>
				</div>
			</div>
		</footer>
		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->

		<!--<script type="text/javascript" th:src="@{/js/angular.min.js}"></script>-->
		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script type="text/javascript" th:src="@{/js/jquery-3.4.1.min.js}"></script>
		<script type="text/javascript" th:src="@{/js/popper.min.js}"></script>
		<script type="text/javascript" th:src="@{/js/bootstrap-4.4.1.js}"></script>
		<script>
			//https://stackoverflow.com/questions/32378590/set-date-input-fields-max-date-to-today
			var today = new Date();
			var dd = today.getDate();
			var mm = today.getMonth() + 1; //January is 0!
			var yyyy = today.getFullYear();

			if (dd < 10) {
				dd = '0' + dd;
			}

			if (mm < 10) {
				mm = '0' + mm;
			}

			today = yyyy + '-' + mm + '-' + dd;
			document.getElementById("fnacimiento").setAttribute("max", today);
		</script>
	</div>
</body>

</html>